<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../bower_components/koa-behaviors/koa-dropdown-menu-behavior.html">
<link rel="import" href="../../../../bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="../the-times-input/the-times-input.html">
<link rel="import" href="../the-times-menu-button/the-times-menu-button.html">
<link rel="import" href="../../styles/default-theme.html">

<dom-module id="the-times-dropdown-menu">
  <template>
    <!-- write your styles here -->
    <style>
      :host {
        display: inline-block;
        position: relative;
        text-align: left;
        cursor: pointer;

        /* NOTE(cdata): Both values are needed, since some phones require the
         * value to be `transparent`.
         */
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        -webkit-tap-highlight-color: transparent;

        --input-container-input: {
          overflow: hidden;
          white-space: nowrap;
          text-overflow: ellipsis;
          max-width: 100%;
          box-sizing: border-box;
          cursor: pointer;
        };

        @apply(--dropdown-menu);
      }

      :host([disabled]) {
        @apply(--dropdown-menu-disabled);
      }

      :host([noink]) paper-ripple {
        display: none;
      }

      :host([no-label-float]) paper-ripple {
        top: 8px;
      }

      paper-ripple {
        top: 12px;
        left: 0px;
        bottom: 8px;
        right: 0px;

        @apply(--dropdown-menu-ripple);
      }

      the-times-menu-button {
        display: block;
        padding: 0;

        @apply(--dropdown-menu-button);
      }

      the-times-input {
        @apply(--dropdown-menu-input);
      }

      koa-icon {
        color: var(--disabled-text-color);

        @apply(--dropdown-menu-icon);
      }
    </style>
    <!-- end styles -->

    <!-- write your template here -->
    <!-- this div fulfills an a11y requirement for combobox, do not remove -->
    <div role="button"></div>
    <the-times-menu-button
      id="menuButton"
      vertical-align="[[verticalAlign]]"
      horizontal-align="[[horizontalAlign]]"
      vertical-offset="[[_computeMenuVerticalOffset(noLabelFloat)]]"
      disabled="[[disabled]]"
      no-animations="[[noAnimations]]"
      on-iron-select="_onIronSelect"
      on-iron-deselect="_onIronDeselect"
      opened="{{opened}}">
      <div class="dropdown-trigger">
        <paper-ripple></paper-ripple>
        <!-- the-times-input has type="text" for a11y, do not remove -->
        <the-times-input
          type="text"
          invalid="[[invalid]]"
          readonly
          disabled="[[disabled]]"
          value="[[selectedItemLabel]]"
          placeholder="[[placeholder]]"
          always-float-label="[[alwaysFloatLabel]]"
          no-label-float="[[noLabelFloat]]"
          label="[[label]]">
          <koa-icon icon="arrow-drop-down" suffix></koa-icon>
        </the-times-input>
      </div>
      <content id="content" select=".dropdown-content"></content>
    </the-times-menu-button>
    <!-- end template -->
  </template>

  <script>
    Polymer({
      is: 'the-times-dropdown-menu',

      behaviors: [
        Polymer.KoaDropdownMenuBehavior
      ],

      properties: {
        /**
         * The value for this element that will be used when submitting in
         * a form. It is read only, and will always have the same value
         * as `selectedItemLabel`.
         */
        value: {
          type: String,
          notify: true,
          readOnly: true
        },

        /**
         * Set to true to disable the floating label. Bind this to the
         * `<the-times-input-container>`'s `noLabelFloat` property.
         */
        noLabelFloat: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },

        /**
         * Set to true to always float the label. Bind this to the
         * `<the-times-input-container>`'s `alwaysFloatLabel` property.
         */
        alwaysFloatLabel: {
          type: Boolean,
          value: false
        },
      },

      /**
       * Compute the vertical offset of the menu based on the value of
       * `noLabelFloat`.
       *
       * @param {boolean} noLabelFloat True if the label should not float
       * above the input, otherwise false.
       */
      _computeMenuVerticalOffset: function(noLabelFloat) {
        // NOTE: These numbers are somewhat magical because they are
        // derived from the metrics of elements internal to `the-times-input`'s
        // template. The metrics will change depending on whether or not the
        // input has a floating label.
        return noLabelFloat ? -4 : 8;
      }
    });
  </script>
</dom-module>
