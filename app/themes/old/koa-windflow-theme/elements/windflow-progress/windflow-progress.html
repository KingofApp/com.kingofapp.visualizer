<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../bower_components/iron-range-behavior/iron-range-behavior.html">

<!--
### Styling

Custom property | Description | Default
----------------|-------------|--------
`--progress-container-color` | Mixin applied to container | `--google-grey-300`
`--progress-transition-duration` | Duration of the transition | `0.008s`
`--progress-transition-timing-function` | The timing function for the transition | `ease`
`--progress-transition-delay` | Delay for the transition | `0s`
`--progress-active-color` | The color of the active bar | `--google-green-500`
`--progress-secondary-color` | The color of the secondary bar | `--google-green-100`
`--progress-disabled-active-color` | The color of the active bar if disabled | `--google-grey-500`
`--progress-disabled-secondary-color` | The color of the secondary bar if disabled | `--google-grey-300`
`--progress-height` | The height of the progress bar | `4px`
-->

<dom-module id="windflow-progress">
  <template>
    <style>
      :host {
          height: 4px;
          background-color: white;
          position: relative;
          width: 100%;
      }
      :host #primaryProgress, :host #secondaryProgress {
        height: 4px;
        width: 0%;
        max-width: 100%;
      }
      :host .dark {
        background-color: #3F51B5;
      }
      :host .light {
        background-color: #C5CAE9;
      }
      :host .primary {
        background-color: #448AFF;
      }
    </style>



    <div id="progress_bar">
        <div id="secondaryProgress"></div>
        <div id="primaryProgress"></div>
    </div>

  </template>
  <script src="../jquery/jquery-2.1.4.min.js"></script>
  <script>
    // Choosing bar color:
    var element = $(this);
    var background;
    var limit = 10;
    var counter = 0;
    do {
        element = element.parent();
        background = element.css("background-color");
        counter++;
    } while(background == undefined && counter < limit);
    // Add appropiate class to the bar
    var newClass;
    switch(background) {
        case "rgb(48, 63, 159)":
            newClass = "light";
            break;
        case "rgb(197, 202, 233)":
            newClass = "dark";
            break;
        default:
            newClass = "primary";
    }
    // console.log(newClass);
    // console.log($(this).find("#primaryProgress"));

    Polymer({
      is: 'windflow-progress',

      hostAttributes: {
        role: 'progressbar'
      },

      behaviors: [
        Polymer.IronRangeBehavior
      ],

      properties: {
        /**
         * True if the progress is disabled.
         */
        disabled: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },

        /**
         * Use an indeterminate progress indicator.
         */
        indeterminate: {
          type: Boolean,
          value: false
        },

        /**
         * The number that represents the current secondary progress.
         */
        secondaryProgress: {
          type: Number,
          value: 0
        },

        /**
         * The secondary ratio
         */
        secondaryRatio: {
          type: Number,
          value: 0,
          readOnly: true
        }
      },
      _hideSecondaryProgress: function(secondaryRatio) {
        return secondaryRatio === 0;
      },
      _update: function() {
          this.value = this.value / this.max * 100;
          if(this.value > 100)
              this.value = 100;
          if(this.value < 0)
              this.value = 0;
          $(this).find("#primaryProgress").css("width", this.value + "%");
          $(this).find("#primaryProgress").addClass(newClass);
      }
    });
  </script>
</dom-module>
